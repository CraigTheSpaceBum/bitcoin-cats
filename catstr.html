<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostr Posts</title>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        .post {
            background-color: grey;
            margin: 20px;
            padding: 20px;
            border-radius: 10px;
        }
        .post p {
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Posts by npub1826v365he5ty69lk3xgvzqrwy8587vdfrxnsz0k09khzustf8r7s6j7t95</h1>
    <div id="posts"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/noble-secp256k1/1.7.1/noble-secp256k1.min.js"></script>
    <script src="https://unpkg.com/@scure/base@1.1.1"></script>
    <script>
        const relays = [
            'wss://relay.damus.io',
            'wss://relay.nostr.info',
            'wss://relay.snort.social',
            'wss://nostr-pub.wellorder.net'
        ];
        
        const pubkey = 'npub1826v365he5ty69lk3xgvzqrwy8587vdfrxnsz0k09khzustf8r7s6j7t95';
        const hexPubKey = decodeBech32(pubkey);

        async function fetchPosts() {
            const events = [];
            for (const relay of relays) {
                try {
                    const ws = new WebSocket(relay);
                    ws.onopen = () => {
                        ws.send(JSON.stringify({
                            "id": "1",
                            "method": "REQ",
                            "params": [{
                                "kinds": [1],
                                "authors": [hexPubKey]
                            }]
                        }));
                    };
                    ws.onmessage = (event) => {
                        const response = JSON.parse(event.data);
                        if (response && response[0] && response[0].event) {
                            events.push(response[0].event);
                        }
                    };
                    ws.onerror = () => {
                        console.error(`Failed to connect to relay: ${relay}`);
                    };
                    await new Promise(resolve => setTimeout(resolve, 1000)); // wait for a second before moving to the next relay
                } catch (error) {
                    console.error(`Error with relay ${relay}: ${error}`);
                }
            }
            displayPosts(events);
        }

        function displayPosts(events) {
            const postsContainer = document.getElementById('posts');
            events.forEach(event => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `<p>${event.content}</p>`;
                postsContainer.appendChild(postElement);
            });
        }

        function decodeBech32(bech32) {
            const { words } = bech32.decode(bech32);
            const bytes = bech32.fromWords(words);
            return bytes.map(byte => byte.toString(16).padStart(2, '0')).join('');
        }

        fetchPosts();
    </script>
</body>
</html>
